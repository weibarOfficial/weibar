!function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="//www.yylive.com/static/",e(e.s=14)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={data:{balance:0},init:function(){return this.loadData()},loadData:function(){var t=this;return $.post("/h5/getUserBalance").then(function(e){e&&0===e.code&&e.data&&(t.data.balance=e.data.balance)})},total:function(){return this.data.balance},add:function(t){this.data.balance+=t},sub:function(t){this.data.balance=Math.max(this.data.balance-t,0),this.data.balance=+this.data.balance.toFixed(2)},createDom:function(t){var e=this.data.balance,i='<div id="priceBox" data-wxpay="0" class="moneyChecked">\n                        <div class="myRedBagBox">\n                            <div class="myRedBagTxt j_isChecked">\n                                <span class="myCheckBlack"></span>\n                                <span class="myCheckText">账户余额：￥<span id="j_balance">'+e+'元</span>\n                                </span>\n                            </div>\n                            <div class="myRedBagTxt j_delMoney" style="text-align:right"></div>\n                        </div>\n                        <div class="lineDiv">需微信支付</div>\n                        <div class="lineDiv" id="price">￥<span  id="j_price">0</span></div>\n                    </div>';t.html(i),t.find(".j_isChecked").on("click",function(){var t=$(this).closest("#priceBox");if(t.toggleClass("moneyChecked"),t.hasClass("moneyChecked")){var e=Math.max(t.data("allprice")-balanceTotal,0);t.data("wxpay",e),$("#j_price").html(e.toFixed(2))}else $("#j_price").html(t.data("allprice").toFixed(2))})},updatePay:function(t){t=Math.max(t,0),t=+Number(t).toFixed(2);var e=$("#priceBox");e.data("allprice",t),e.find(".j_delMoney").html("-"+t+"元");var i=0;i=e.hasClass("moneyChecked")?this.data.balance-t>=0?0:t-this.data.balance:t,e.data("wxpay",i),$("#j_price").html(i.toFixed(2))},updateBalance:function(){this.sub($("#priceBox").data("allprice"))},requireEncharge:function(t,e){WM.Phone.get({type:"confirm",title:"支付确认",innerHTML:"您的账户余额已不足,还需支付"+t+"元，是否前往微信支付？",click:function(t){this.close(),t&&(sessionStorage.setItem(Global.SESSION_KEY_WX_PAY,JSON.stringify(e)),window.location.href="./pay.html?returnurl="+encodeURIComponent(document.location.href))}})},directEncharge:function(t){WM.Phone.get({type:"confirm",title:"余额不足",innerHTML:"是否前往微信支付？充值金额 "+t+"元？",click:function(e){this.close(),e&&(window.location.href="./pay.html?amount="+100*t+"&returnurl="+encodeURIComponent(document.location.href))}})},jumpEncharge:function(t){window.location.href="./pay.html?amount="+100*t+"&returnurl="+encodeURIComponent(document.location.href)}};e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),window.App||(window.App={}),window.allImageUrl="./images/",window.Global={SESSION_KEY_WX_PAY:"SESSION_KEY_WX_PAY",allImageUrl:allImageUrl,API_BASE:"",WS_BASE:"http://120.79.15.148:8080",merchantId:App.Utils.urlParam("merchantId")||1,chatId:null,User:{nickname:"app测试",userId:"1511958518205",scopeLevel:3,sex:"男",userPicture:""},login:function(){return this.DEBUG?$.getJSON(Global.API_BASE+"/test/loginByOpenId",{openId:Global.openId}):Promise.resolve()},loadUserInfo:function(){return $.getJSON("/h5/getUserInfo").then(function(t){t&&0===t.code&&$.extend(Global.User,t.data)})},getChatId:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Global.talkToId;return $.post("/h5/getChatId?toUserId="+t).then(function(t){if(t&&0===t.code)return Global.chatId=t.data,t.data;App.showInfo("获取chatId失败",!1)})}},App.errorTip=function(t){return function(e){App.showInfo(e&&e.message||t||"操作失败，请重试。",!1)}},/MicroMessenger/i.test(navigator.userAgent)||(Global.DEBUG=!0,Global.openId=App.Utils.urlParam("openId")||"ouc82xNQp2oQstpR6g9MD0Dtjupw"),e.default=window.Global},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.BasicFilter=function(){return function(t){t._sexCls="男"===(t.sex||t.fromSex)?"man":"woman",t._isSelf=t.fromUserId==Global.User.userId||t.userId==Global.User.userId,t._ownerCls=t._isSelf?"myTxt":"other",t._timeStr=App.Utils.fmDate(t.createTime,"MM-DD hh:mm"),t._hasTextCls=t.content?"hasText":"";var e=t.msgImgUrl&&t.msgImgUrl.split("|");return e&&e.length>1&&(t._imgArr=e),e&&!t._isSelf&&t.status===App.MsgModule.STATUS.NOT_BA&&t.type!==App.MsgModule.MSG_TYPE.GIVE?t._forTaBp=!0:t._hideLineCls="f-hidden",t.content?t.content=App.FaceModule.replaceText(t.content):t.message&&(t.message=App.FaceModule.replaceText(t.message)),t}}(),e.default=ApplicationCache.BasicFilter},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.UploadModule=function(){function t(t,e){var i=$.Deferred(),n=null;if(e.width=null==e.width?0:e.width,e.height=null==e.height?0:e.height,t){if(!/^(image\/jpeg|image\/png)$/i.test(t.type)&&""!=t.type)return void i.reject("请选择jpeg、png格式的图片");EXIF.getData(t,function(){EXIF.getAllTags(this),n=+EXIF.getTag(this,"Orientation")}),i.notify();var a=new FileReader;a.onload=function(t){var a=new Image;a.src=t.target.result,a.onerror=function(){i.reject("当前文件不可用，请重新选择")},a.onload=function(){var t=this.naturalWidth,a=this.naturalHeight;if(t<e.width||a<e.height)return void i.reject("请上传宽度大于"+e.width+"px，高度大于"+e.height+"px 的图片");this.naturalWidth>this.naturalHeight&&this.naturalWidth>800?(t=800,a=t*this.naturalHeight/this.naturalWidth):this.naturalHeight>this.naturalWidth&&this.naturalHeight>1200&&(a=1200,t=a*this.naturalWidth/this.naturalHeight);var s=document.createElement("canvas"),o=s.getContext("2d");if(s.width=t,s.height=a,n&&1!=n)switch(n){case 6:s.width=a,s.height=t,o.rotate(Math.PI/2),o.drawImage(this,0,-a,t,a);break;case 3:o.rotate(Math.PI),o.drawImage(this,-t,-a,t,a);break;case 8:s.width=a,s.height=t,o.rotate(3*Math.PI/2),o.drawImage(this,-t,0,t,a)}else o.drawImage(this,0,0,t,a);var l=s.toDataURL("image/jpeg",.8);i.resolve(l)}},a.readAsDataURL(t)}else i.reject("未指定上传文件");return i}function e(t){this.config=$.extend({},{url:"/h5/uploadPic",base64:!0,$input:null,filename:"file",data:null,num:1,width:200,height:200,size:1024e4,onStart:null,onSuccess:null,onError:null},t),this.init()}return e.prototype={init:function(){this.initEvents(),this.config.url=this.config.base64?"/h5/uploadPicBase64":"/h5/uploadPic"},initEvents:function(){var t=this;this.config.$input.on("change",function(){t.upload(this.files)})},upload:function(e){var i=this,n=e[0];if(n.size>this.config.size)return App.showInfo("上传图片不能大于"+this.config.size/1024e3+"M",!1),!1;this.config.base64?t(n,{width:this.config.width,height:this.config.height}).progress(function(){i.config.onStart&&i.config.onStart()}).then(function(t){this.start(t)}.bind(this),function(t){i.config.onError&&i.config.onError({message:t})}):(this.config.onStart&&this.config.onStart(),this.start(n))},start:function(t){var e=this,i={url:this.config.url,type:"POST",cache:!1,data:{}};if(this.config.base64)$.extend(i.data,this.config.data),i.data[this.config.filename]=t.replace("data:image/jpeg;base64,","");else{i.processData=!1,i.contentType=!1;var n=new FormData;if(this.config.data)for(var a in this.config.data)n.append(a,this.config.data[a]);n.append(this.config.filename,t),i.data=n}this.currUpload=$.ajax(i).done(function(t){e.config.onSuccess&&e.config.onSuccess(t)}).fail(function(t){try{e.config.onError&&e.config.onError(JSON.parse(t))}catch(i){e.config.onError&&e.config.onError(t)}}).always(function(){e.currUpload=null})},clear:function(){try{this.currUpload.abort()}catch(t){}}},{init:function(){},instance:function(t){return new e(t)}}}(),e.default=ApplicationCache.UploadModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.SensitiveModule=function(){var t=["江泽民","枪支弹药","我操"];return{valide:function(e){var i=!0;return $.each(t,function(t,n){if(e&&-1!==e.indexOf(n))return i=!1}),i},filter:function(e){return t.forEach(function(t){e&&(e=e.replace(new RegExp(t,"gi"),"*"))}),e}}}(),e.default=App.SensitiveModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.ScrollModule={len:300,delay:100,animateTime:150,timeout:null,top:0,init:function(t){var e=this;$(window).bind("scroll",function(){e.top=$(window).scrollTop()}),setTimeout(function(){$("html,body").stop().animate({scrollTop:$(document).height()-$(window).height()},e.animateTime),t&&setTimeout(function(){t()},e.animateTime)},500)},down:function(t){var e=this;t=!1!==t;try{clearTimeout(this.timeout)}catch(t){}this.timeout=setTimeout(function(){var i=$(document).height()-$(window).height();(t||i-e.top<=e.len)&&$("html,body").stop().animate({scrollTop:i},e.animateTime)},this.delay)}},e.default=App.ScrollModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.UserBoxModule={$box:null,imageLoad:!1,imageData:[],ready:!0,ajaxLoad:!1,swiper:null,loadNum:3,options:{fromDetail:!1},init:function(t){$.extend(this.options,t);var e=this;this.$box=$(".j_userBox").on("click",function(){e.close()}).on("click",".j_sendGift",function(){App.GiftModule.showGiftPanel(e.currEl)}).on("click",".j_talkTo",function(t){t.preventDefault();var i=(e.currEl.attr("data-name"),e.currEl.attr("data-uid")),n=(e.currEl.attr("data-userpic"),Global.merchantId);location.href="./talk.html?uid="+i+"&merchantId="+n}),App.MsgModule.getCnt().on("click",".j_popProfile",function(t){return t.preventDefault(),e.show($(this)),!1})},reset:function(){this.imageLoad=!1,this.ajaxLoad=!1,this.imageData=[],this.$box.find(".userBoxAllBg").html("");try{this.swiper.destroy(!0)}catch(t){}},setImages:function(t){for(var e=WM.Phone.loading.getHtml(),i=$("#swiper-container1 .swiper-slide"),n=Array.prototype.slice.call(i,t,t+this.loadNum),a=0;a<n.length;a++)$(n[a]).hasClass("loaded")||($(e).insertBefore($(n[a]).find(".userBg")),$(n[a]).addClass("loaded"),$(n[a]).find("img").attr({src:$(n[a]).find("img").attr("_src")}))},imgLoad:function(t){$(t.parentNode).find(".Phone_loading").remove(),$(t.parentNode).find(".reflectionBox").css({visibility:"visible"}),$(t.parentNode).find("img").css({visibility:"visible"})},load:function(t){this.imageLoad=!0,this.initImageList()},showAll:function(){$(".userBox .firstSlide").find(".reflectionBox").css({visibility:"visible"}),$(".userBox .firstSlide").find("img").css({visibility:"visible"}),$(".userBox>.Phone_loading").hide(),$(".userBox").find(".userInfo").show()},initImageList:function(){if(this.imageLoad&&this.ajaxLoad){this.imageLoad=!1,this.ajaxLoad=!1;for(var t=this.imageData,e="",i=0;i<t.length;i++)e+=this.create(t[i]);$(e).appendTo($("#swiper-container1 .swiper-wrapper")),this.initSwiper(),this.showAll(),this.setImages(0)}},initSwiper:function(){var t=$(".swiper-slide").length,e=this;this.swiper=new Swiper("#swiper-container1",{paginationType:$(".swiper-slide").length>0?"fraction":"bullets",onTransitionStart:function(t){(t.activeIndex+1)%e.loadNum==0&&e.setImages(t.activeIndex+1)},onInit:function(){if(t<=1)return void $("#userTipIndex").html("");$("#userTipIndex").html("1/"+t+"&nbsp;&nbsp;")},onSlideChangeEnd:function(e){t<=1||$("#userTipIndex").html(e.activeIndex+1+"/"+t+"&nbsp;&nbsp;")}})},close:function(){try{getUserImage.abort()}catch(t){}$(".userBox").hide(),this.reset(),$(".userBoxAllBg").html("")},create:function(t,e){return e?'<div class="swiper-slide firstSlide loaded"><img src="'+t+'" class="userBg"                  onload="App.UserBoxModule.load(this)" onerror="App.UserBoxModule.load(this)"/>                 <div class="reflectionBox"><img class="reflection" src="'+t+'" /></div></div>':'<div class="swiper-slide"><img _src="'+t+'" class="userBg beforeLoad"             onerror="App.UserBoxModule.imgLoad(this)" onload="App.UserBoxModule.imgLoad(this)" />            <div class="reflectionBox"><img class="reflection beforeLoad" _src="'+t+'" /></div></div>'},show:function(t){this.reset(),this.currEl=t;var e=t.attr("data-src")||"",i=t.attr("data-name")||"",n=t.attr("data-sex")||"",a=t.attr("data-age")||"",s=t.attr("data-cm")||"",o=t.attr("data-kg")||"",l=t.attr("data-job")||"",r=t.attr("data-txt")||"",d=t.attr("data-uid")||"",c=(t.attr("data-url"),t.attr("gradeColor")||""),u=t.attr("gradeName")||"",p=t.attr("data-userpic")||"";t.attr("gradeclass"),t.attr("gradeImg");if(0===this.$box.find(".Phone_loading").length){var h=WM.Phone.loading.getHtml();$(h).appendTo(this.$box)}else this.$box.find(".Phone_loading").show();var f='<div class="swiper-container" id="swiper-container1"><div class="swiper-wrapper">';f+=this.create(e,!0),f+='</div><div class="swiper-pagination" id="swiper-pagination1" style="position:absolute; bottom:10px;">&nbsp;</div></div>',$(".userBoxAllBg").html(f),$(".userInfo .grade_change").html(""),$(".userInfo .grade_change").append("<img src="+p+' class="cy_userH" width="40px"/>'),"qt_color"!=c&&null!=u&&""!=u&&$(".userInfo .grade_change").append("<p class="+c+">"+u+"</p>"),$(".userInfo .p1").html(i+'<span class="'+("男"==n?"man":"woman")+'">'+n+"</span>");var m="";null!=a&&""!=a&&(m+="<span>"+a+"岁&nbsp;&nbsp;/&nbsp;&nbsp;</span>"),null!=s&&""!=s&&(m+="<span>"+s+"Cm&nbsp;&nbsp;/&nbsp;&nbsp;</span>"),null!=o&&""!=o&&(m+="<span>"+o+"Kg&nbsp;&nbsp;/&nbsp;&nbsp;</span>"),null!=l&&""!=l&&(m+="<span>"+l+"</span>"),$(".userInfo .p2").html(m+'<p style="clear:both"></p>'),r=r||"",$(".userInfo .p3").html(r),!0!==this.options.fromDetail&&(Global.User.userId==d||(m=!0!==Global.isshutup?'<div><a class="j_talkTo">私信</a></div><div><a  class="j_sendGift">送礼物</a></div>':'<div><a class="only j_sendGift">送礼物</a></div>',$(".userInfo .aBox").html(m))),$(".userBox").show();var g=this;g.ajax_getUserImage().done(function(t){g.imageData=t,g.initImageList()}).fail(function(){g.imageData=[]}).always(function(){g.ajaxLoad=!0})},ajax_getUserImage:function(t){return(new $.Deferred).resolve([])}},e.default=App.UserBoxModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={faceUrl:"./images/faces/",newFace:{ic_emoji_666:"[666]",ic_emoji_bishi:"[鄙视你]",ic_emoji_bukaixin:"[不开心]",ic_emoji_dai:"[呆]",ic_emoji_haixiu:"[害羞]",ic_emoji_huaji:"[滑稽]",ic_emoji_keai:"[可爱]",ic_emoji_kelian:"[可怜]",ic_emoji_ku:"[哭]",ic_emoji_liulei:"[流泪]",ic_emoji_memeda:"[么么哒]",ic_emoji_mengbi:"[懵逼]",ic_emoji_nu:"[怒]",ic_emoji_se:"[色]",ic_emoji_shuai:"[衰]",ic_emoji_tanqi:"[叹气]",ic_emoji_tiaopi:"[调皮]",ic_emoji_wabizi:"[挖鼻子]",ic_emoji_weiqu:"[很委屈]",ic_emoji_weixiao:"[微笑]",ic_emoji_wulian:"[捂脸]",ic_emoji_wuzui:"[捂嘴]",ic_emoji_xiao:"[笑]",ic_emoji_xiaoku:"[笑哭]",ic_emoji_yun:"[晕]",ic_emoji_zaijian:"[再见了]",ic_emoji_zhuakuang:"[抓狂]"},init:function(t,e){this.$input=e,this.$trigger=t,this.initDom(),this.initEvent()},initDom:function(){var t="",e=0,i=!1;for(var n in this.newFace)e%7==0&&(t+="<div>",i=!0),t+='<a index="'+n+'" class="j_addFace"><img src="'+this.faceUrl+n+'.png" /></a>',(e+1)%7==0&&(t+="</div>",i=!1),e++;if(i){for(;e%7!=0;)t+="<a></a>",e++;t+="</div>"}$("#allFace").html(t+'<div style="clear:both"></div>')},initEvent:function(){var t=this;this.$trigger.on("click",function(){t.show()}),this.$cnt=$("#allFace").on("click",".j_addFace",function(){t.setFace($(this))})},show:function(){$("#allFace").hasClass("hide")?($("#allFace").removeClass("hide"),$(window).bind("mousedown.face",function(t){var e=t.target;"txt"!=e.id&&"allFace"!=e.id&&($("#allFace").find(e).length>0||($(window).unbind("mousedown.face"),setTimeout(function(){$("#allFace").addClass("hide")},250)))})):this.closeFace()},closeFace:function(){$(window).unbind("mousedown.face"),$("#allFace").addClass("hide")},insertHtml:function(t){this.isShow(!1);var e=this.$input[0];if(document.selection){document.selection.createRange().text=t,this.$input.blur()}else if("number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd){var i=e.selectionStart,n=e.selectionEnd,a=i,s=e.value;e.value=s.substring(0,i)+t+s.substring(n,s.length),a+=t.length,e.selectionStart=e.selectionEnd=a,this.$input.blur()}else e.value+=t,this.$input.blur();this.isShow(!0)},isShow:function(t){t?$(".wallHead,.fixedIcon").css("display","block"):$(".wallHead,.fixedIcon").css("display","none")},setFace:function(t){var e=this.newFace[$(t).attr("index")];this.insertHtml(e)},replaceText:function(t){if(t){var e=this.newFace;for(var i in e)for(;-1!=t.indexOf(e[i]);)t=t.replace(e[i],'<img class="emoji_face" src="'+this.faceUrl+i+'.png" />');return t}return""}};e.default=App.FaceModule=n},function(t,e,i){"use strict";function n(t){t&&t.fromDetail?this.ajaxLoadFn="_ajaxLoadDetail":this.ajaxLoadFn="ajaxLoad",this.options=$.extend({activeTimer:!1,params:null},t)}Object.defineProperty(e,"__esModule",{value:!0}),n.prototype={hasMore:!0,loading:!1,pageCount:20,nowPage:1,preTimestamp:null,nextTimestamp:null,$loadingEl:null,init:function(){var t=this;this.$loadingEl=$(".loadMore"),this.initTip=new WM.Phone.waiting({text:"正在为您加载",hasCover:!1,clickClose:!1}),$(window).scroll(function(){$(window).scrollTop()<=10&&t.loadPrevious()}),this.firstLoad()},startTimer:function(){var t=this;this.options.activeTimer&&(this.timer=setInterval(function(){t.loadNext()},5e3))},loadNext:function(){var t=this;this[this.ajaxLoadFn]({beginTime:this.nextTimestamp}).then(function(e){e&&0===e.code&&e.data&&e.data.length&&(t.nextTimestamp=e.data[e.data.length-1].createTime,App.MsgModule.appendData(e.data))},function(t){}).always(function(){})},loadPrevious:function(){var t=this;if(!this.loading){if(!this.hasMore)return this.$loadingEl.find("tt").html("没有更多了"),void this.$loadingEl.show().removeClass("animate");this.$loadingEl.find("tt").html("正在为您加载"),this.$loadingEl.show(),this.loading=!0,this[this.ajaxLoadFn]({endTime:this.preTimestamp}).then(function(e){e&&0===e.code?(t.checkData(e.data),App.MsgModule.prependData(e.data)):App.showInfo(e&&e.message||"加载失败",!1)},function(t){App.showInfo(t&&t.message||"加载失败",!1)}).always(function(){t.$loadingEl.hide(),t.loading=!1})}},checkData:function(t){return t&&t.length||(this.hasMore=!1),t.length&&(this.preTimestamp=t[0].createTime,this.nextTimestamp||(this.nextTimestamp=t[t.length-1].createTime)),t},firstLoad:function(){var t=this;this.loading=!0,this[this.ajaxLoadFn]({endTime:Date.now()}).then(function(e){e&&0===e.code?(t.checkData(e.data),App.MsgModule.appendData(e.data),t.initTip.close(),t.startTimer()):App.showInfo(e&&e.message||"加载失败",!1)},function(e){WM.Phone.get({type:"alert",innerHTML:e&&e.message||"加载失败，请点击确定重试",click:function(){this.close(),t.firstLoad()}})}).always(function(){t.loading=!1})},ajaxLoad:function(t){return t.count=this.pageCount,t.merchantId=Global.merchantId,$.ajax({url:"/h5/barrageList",data:t,dataType:"json",method:"POST"})},_ajaxLoadDetail:function(t){return t.count=this.pageCount,t.toUserId=Global.talkToId,t.chatId=Global.chatId,$.ajax({url:"/h5/chatList",data:t,dataType:"json",method:"POST"})}},App.LoadModule=n,e.default=App.LoadModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),a=function(t){return t&&t.__esModule?t:{default:t}}(n);App.GiftModule={dtd:new $.Deferred,data:null,options:{fromDetail:!1,params:null},GIVE_TYPE:{PUBLIC:1,PRIVITE:2},init:function(t){var e=this;$.extend(this.options,t),this.loadData(),this.options.fromDetail?(this.options.giveType=this.GIVE_TYPE.PRIVITE,t.$triggerEl&&t.$triggerEl.on("click",function(){e.showGiftPanel($(this))})):this.options.giveType=this.GIVE_TYPE.PUBLIC},loadData:function(){var t=this;$.ajax({url:Global.API_BASE+"/h5/goodsSettingInfo",data:{merchantId:Global.merchantId},dataType:"json"}).done(function(e){e&&0===e.code?(t.data=e.data,t.dtd.resolve(e.data)):t.dtd.reject(e&&e.message||"礼物加载失败")}).fail(function(e){t.dtd.reject(e&&e.message||"礼物加载失败")})},getData:function(){return this.dtd},getAllGiftHtml:function(){return this.getData().then(function(t){var e="";return e+='<div class="wm_slideRowTitle" style="padding:0;margin:5px 0;">礼物</div>',e+='<div class="wm_otherBar" style="padding:0;margin:5px 0;">                        <div class="dsObjMain" style="padding:0;margin:0;">                            <div class="dsObjBox dsObjBox2">',t.forEach(function(t){e+='<a class="oneDsObj" data-id="'+t.goodsId+'" data-price="'+t.goodsAmount+'">                            <span class="oneDsObjSpan"><img src="'+t.goodsImgUrl+'" style="max-width:100%"/></span>                            <tt class="ellipsis">'+t.goodsName+'</tt>                            <tt class="ellipsis" style="margin-top:0;height:12px;line-height:12px;">￥'+t.goodsAmount+'</tt><i class="oneDsObjNum"></i></a>'}),e+="</div></div></div>"},function(){return null})},showGiftPanel:function(t){var e=this,i=t.attr("data-userpic")||"",n=t.attr("data-name")||"",s=t.attr("data-uid")||"",o='<div style="text-align:center">                        <img src="'+i+'" style="border-radius:4px; width:60px; height:60px" />                        <p style="margin-top:5px;">'+n+"</p>                    </div>";this.getAllGiftHtml().then(function(t){if(!t)return App.showInfo("打赏礼物暂不可用，请稍后重试");o+=t,o+='<div style="margin-top:8px" id="dsWordBox"><input type="text" class="inputNormal" id="dsWord" maxlength="60" placeholder="留言，30字以内" style="font-size:13px; text-indent:14px; box-sizing:border-box; height:40px; line-height:41px; padding:0px" /></div>',e.options.fromDetail||(o+='<a class="isShowToPc sel"><i class="icon_gift_select"></i>在大屏幕上显示</a>'),o+='<div id="j_priceBox"></div>';e.dsParams={userIdGiven:s};var i=WM.Phone.get({type:"slideBox",title:"送礼物",html:o,btnText:"购买礼物",ready:function(){this.find(".wm_slideBody").css({"padding-top":0}),this.find(".oneDsObj").bind("click",function(){$(this).hasClass("sel")||$(this.parentNode).find(".oneDsObj").removeClass("sel").attr({"data-num":0}),$(this).addClass("sel").attr({"data-num":1}).find(".oneDsObjNum").html(1);var t=1*$.trim($(this).attr("data-price"));a.default.updatePay(t),e.dsParams.goodsId=$(this).attr("data-id")}),this.find(".isShowToPc").bind("click",function(){if($(this).hasClass("sel"))return $(this).removeClass("sel");$(this).addClass("sel")}),a.default.createDom(this.find("#j_priceBox"))},click:function(){var t=$.trim(this.find("#dsWord").val()),n=e.dsParams.goodsId,s=this;if(App.Utils.getTextLength(t)>30)return showInfo("留言不能超过30字",!1,{top:"86%"});if(!App.SensitiveModule.valide(t))return showInfo("请勿发布广告等不适内容",!1,{top:"86%"});if(""==n||void 0===n)return showInfo("请选择礼物",!1,{top:"86%"});e.dsParams.content=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.dsParams.giveType=this.find(".isShowToPc").hasClass("sel")?e.GIVE_TYPE.PUBLIC:e.GIVE_TYPE.PRIVITE;var o=this.getButton();o.hasClass("disabled")||(o.addClass("disabled"),this.cover(!0),e.ajaxDsMsg(e.dsParams).done(function(t){t&&0===t.code&&t.data&&t.data.banlanceEnough?(a.default.updateBalance(),i.close(),e.options.fromDetail?t.data.privateChat&&App.MsgModule.appendData(t.data.privateChat):e.dsParams.giveType===e.GIVE_TYPE.PUBLIC&&t.data.barrageInfo&&App.MsgModule.appendData(t.data.barrageInfo)):t&&0===t.code&&t.data&&!t.data.banlanceEnough?a.default.requireEncharge(t.data.minRechargeAmount,t.data.wechatMpPrePay.wxPayMpOrderResult):App.showInfo("操作失败",!1,{top:"86%"})}).fail(function(t){App.showInfo(t&&t.message||"操作失败",!1,{top:"86%"})}).always(function(){o.removeClass("disabled"),s.cover(!1)}))}})})},ajaxDsMsg:function(t){return $.ajax({url:Global.API_BASE+"/h5/give",method:"POST",dataType:"json",data:$.extend(t,{merchantId:Global.merchantId},this.options.params)})}},e.default=App.GiftModule},function(t,e,i){"use strict";function n(t){if($.extend(l,t),l.privateChat?l.prefix="chat":l.prefix="merchant",!1 in window)return void App.showInfo("WebSocket 不支持",!1);var e=new SockJS(Global.WS_BASE+"/websocket");s=Stomp.over(e),s.connect({},function(t){console.log("Connected: "+t),s.subscribe("/wsSend/"+l.prefix+"_"+l.chatId,function(t){t.body&&l.callback&&l.callback(JSON.parse(t.body))}),s.send("/ws/"+l.prefix+"_"+l.chatId,{},"")},r)}function a(){null!==s&&s.disconnect(),clearTimeout(o),console.log("Disconnected")}Object.defineProperty(e,"__esModule",{value:!0});var s=null,o=null,l={},r=function(t){console.log("STOMP: "+t),o=setTimeout(n,5e3),console.log("STOMP: Reconecting in 5 seconds")};e.default={connect:n,disconnect:a}},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}i(1);var a=i(0),s=n(a);i(2),i(15),i(3),i(4),i(5),i(6),i(7);var o=i(8),l=n(o);i(9),i(16),i(17),i(18);var r=i(10),d=n(r);i(11),i(12),i(13),i(19),App.MsgFormModule={$msgCnt:null,init:function(){this.$msgCnt=$("#j_msgFormCnt"),this.initUpload(),this.initEvent(),this.$msgCnt.find(".j_logo").attr("src",Global.User.userPicture).addClass("男"===Global.User.sex?"man":"woman")},initUpload:function(){var t=this;this.uploadInstance=App.UploadModule.instance({$input:this.$msgCnt.find("#upload"),onStart:function(){t.showUploading()},onError:function(e){t.uploadError(e&&e.message)},onSuccess:function(e){e&&0===e.code&&e.data?t.uploadSuccess(e.data):t.uploadError(e&&e.message)}})},initEvent:function(){var t=this;this.$msgCnt.on("click",".afterUpload",function(){t.delImage()}).on("click","#submit",function(){t.post($(this))}).on("submit","#form",function(){return t.post($("#submit")),!1}).on("click",".j_showProfile",function(){t.showProfile()})},showUploading:function(){this.$msgCnt.find("#txt").addClass("hasImage"),this.$msgCnt.find(".afterUpload").remove(),$('<a class="afterUpload"><tt class="onloading"></tt><tt class="slideClose"></tt></a>').appendTo(this.$msgCnt.find(".newFoot-inputBox"))},uploadSuccess:function(t){this.$msgCnt.find(".afterUpload").html('<img class="img" src="'+t+'" /><tt class="slideClose"></tt>')},uploadError:function(t){App.showInfo(t||"上传失败",!1),this.clearImg()},clearImg:function(){this.$msgCnt.find("#txt").removeClass("hasImage"),this.$msgCnt.find(".afterUpload").remove()},delImage:function(){var t=this;WM.Phone.get({type:"confirm",title:"删除",innerHTML:"确定删除此图片?",click:function(e){t.uploadInstance.clear(),t.clearImg(),this.close()}})},resetForm:function(){this.clearImg(),this.$msgCnt.find("#txt").val("")},post:function(t){var e=this;if(!t.hasClass("disabled")){var i=this.$msgCnt.find("#txt").val(),n=this.$msgCnt.find(".afterUpload .img").attr("src");if(!(i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;"))&&!n)return App.showInfo("请输入上墙内容或者上传图片",!1);t.addClass("disabled"),$.ajax({url:Global.API_BASE+"/h5/addWordsAndPic",method:"POST",data:{merchantId:Global.merchantId,openId:Global.openId,content:i,picUrl:n}}).done(function(t){t&&0===t.code?(e.resetForm(),App.MsgModule.appendData(t.data)):App.showInfo(t&&t.message||"消息发送失败",!1)}).fail(function(){}).always(function(){t.removeClass("disabled")})}},showProfile:function(){var t=this,e=$.extend({},Global.User);"男"===e.sex?(e.headCls="newMy_head_man",e.sexCls="sex_man"):(e.headCls="newMy_head_woman",e.sexCls="sex_woman"),e.balance=s.default.total();var i=template("profileTpl",e);WM.Phone.get({type:"slideBox",html:i,title:"我",style:{padding:0},hasFoot:!1,ready:function(){var e=this,i=this.find("#j_profilePopPanel");this.find(".wm_slideTitle").css({padding:"15px 15px 0 15px"}),this.find(".wm_slideTitleLine").css({top:"16px",left:"10px"}),this.find(".wm_slideCloseBox").css({top:"7px",right:"3px"}),this.find(".wm_slideBody").css({"padding-top":"0"}),null!=App.skinModule.sel&&$(i).find(".oneSkin").eq(App.skinModule.sel).addClass("newMy_sky_sel").siblings(".oneSkin").removeClass("newMy_sky_sel"),$(i).find(".oneSkin").on("click",function(){$(this).hasClass("newMy_sky_sel")||($(this).addClass("newMy_sky_sel").siblings(".oneSkin").removeClass("newMy_sky_sel"),App.skinModule.change($(this).index()),e.close())}),$(i).find(".j_encharge").on("click",function(){t.showEncharge()})}})},showEncharge:function(){var t=[10,20,50,100,200,500],e='<div class="recharge j_enchargeBox">';e+='<div class="moreList j_enchargeList">';for(var i=0;i<t.length;i++)e+='<div num="'+t[i]+'"  class="oneRow j_preEncharge" style="text-align:center">',e+="<span>"+t[i]+"&nbsp;元</span>",e+="</div>";e+="</div>",e+="</div>",$(e).appendTo($("body")),setTimeout(function(){$(".j_enchargeList").addClass("change")},50),$(".j_enchargeBox").on("click",function(){$(".j_enchargeList").removeClass("change"),setTimeout(function(){$(".j_enchargeBox").remove()},200)}).on("click",".j_preEncharge",function(t){t.stopPropagation();var e=$(this).attr("num");WM.Phone.get({type:"confirm",title:"提示",innerHTML:"确认充值 <strong>"+e+"</strong> 元？",click:function(t){if(!t)return this.close();s.default.jumpEncharge(e)}})})}},App.MsgModule={$cnt:null,MSG_TYPE:{TEXT:0,PHOTO:1,GIVE:2,RED_BAG:3,VOTE:5,SONG:4,WORDS_AND_PHOTO:6,RED_BAG_GOT:7},STATUS:{REMOVE:4,NOT_SHOW:3,BA:2,NOT_BA:1},init:function(){var t=this;this.$cnt=$(".onWallMain").show(),this.$cnt.on("click",".j_delMsg",function(){t.delMsg($(this))}).on("click",".j_showSparmForTa",function(){App.SpamScreenModule.showPanel($(this),!0)}).on("click",".j_showImage",function(){t.showImage($(this))})},getCnt:function(){return this.$cnt},showImage:function(t){var e=$(t).attr("src");e&&WM.Phone.showImage(e)},createItem:function(t){if(t=App.BasicFilter(t),t.content=App.SensitiveModule.filter(t.content),t.type===this.MSG_TYPE.GIVE)return t.giveInfo?this.dsMsg(t):"";if(t.type===this.MSG_TYPE.VOTE);else{if(t.type===this.MSG_TYPE.RED_BAG)return this.redBagMsg(t);if(t.type!==this.MSG_TYPE.SONG)return t.type===this.MSG_TYPE.RED_BAG_GOT?t.redPackageGiveUserId===Global.User.userId?this.redBagGotMsg(t):"":t.status===this.STATUS.BA?this.bpMsg(t):this.normalMsg(t)}},redBagGotMsg:function(t){var e=t.nickName+"领取了你的红包";return t.redPackageGiveUserId===Global.User.userId?(t.userId===Global.User.userId&&(e="你领取了自己的红包"),'<div class="getRedBagTxt row">                <span><i class="onWall_redBagIconMini"></i>'+e+"</span></div>"):""},bpMsg:function(t){var e="txt-Icon ",i="";switch(t.barpinTheme){case 1:e+="txt-cakeIcon",i="生日霸屏";break;case 2:e+="txt-loveIcon",i="示爱霸屏";break;case 3:e+="txt-trystIcon",i="求约霸屏";break;case 4:e+="txt-proposeIcon",i="求婚霸屏";break;case 5:e+="txt-beautifulIcon",i="女神霸屏";break;default:e+="txt-bpIcon",i="重金霸屏"}return t._bpIcon=e,t._bpTxt=i+t.second+"秒  "+(t.times>1?t.times+"次":""),t._normalMsgCls="",this.normalMsg(t)},dsMsg:function(t){return t._dsIcon="txt-Icon txt-dsIcon",t._normalMsgCls="",this.normalMsg(t)},normalMsg:function(t){return void 0===t._normalMsgCls&&(t._normalMsgCls="normalMsg",!t.isSelf&&t.msgImgUrl?t._onlyText="":t._onlyText="onlyText"),template("msgTpl",t)},redBagMsg:function(t){return template("redBagTpl",t)},createHtml:function(t){function e(t){return!(!i.willShow(t)||i.isForTaBp(t)||i.isDulplicate(t))}var i=this,n="";return t=$.isArray(t)?t:[t],t.forEach(function(t){e(t)&&(n+=i.createItem(t))}),n},replaceHtml:function(t){var e=this.$cnt.find('.j_row[mid="'+t.messageId+'"]'),i=this.createItem(t);e.replaceWith(i)},willShow:function(t){var e=null;return t.status===this.STATUS.REMOVE?(e=this.$cnt.find('.j_row[mid="'+t.messageId+'"]'),e.length&&e.remove(),!1):t.status!==this.STATUS.NOT_SHOW},isDulplicate:function(t){return!!this.$cnt.find('.j_row[mid="'+t.messageId+'"]').length},isForTaBp:function(t){return this.$cnt.find('.j_row[mid="'+t.messageId+'"]').data("status")==this.STATUS.NOT_BA&&t.status===this.STATUS.BA&&(this.replaceHtml(t),!0)},appendData:function(t,e){!0===e?this.$cnt.append(this.replaceHtml(t)):(this.$cnt.append(this.createHtml(t)),App.ScrollModule.down())},prependData:function(t){this.$cnt.prepend(this.createHtml(t))},ajaxDelMsg:function(t){return $.ajax({url:Global.API_BASE+"/h5/deleteBarrage",data:$.extend({openId:Global.openId,merchantId:Global.merchantId},t)})},delMsg:function(t){var e=this;WM.Phone.get({type:"confirm",title:"删除",innerHTML:"确定删除此上墙内容？",click:function(i){if(!i)return this.close();var n=t.closest(".j_row"),a=n.attr("mid");"wemewSystem"===Global.User.userId&&(n.remove(),this.close());var s=this;WM.Phone.setButton(this.getButton()[1],!1),e.ajaxDelMsg({messageId:a}).then(function(t){t&&0===t.code?(n.remove(),s.close(),e.checkNull()):(WM.Phone.setButton(s.getButton()[1],!0),App.showInfo(t&&t.message||"删除失败",!1))},function(t){WM.Phone.setButton(s.getButton()[1],!0),App.showInfo(t&&t.message||"删除失败",!1)})}})},checkNull:function(){if($(".row").length>0)return $("#onWallnull").remove();if(!($("#onWallnull").length>0))try{var t=document.title;$('<div id="onWallnull" style="text-align:center; font-size:13px; color:#fff; padding:20px 0; text-shadow:0 0 5px #000;">欢迎来到'+t+"</div>").insertBefore($("#first"))}catch(t){}}},$(function(){Global.login().then(function(){$.getJSON("/h5/getMerchantInfoWhenLogin",{merchantId:Global.merchantId}).then(function(t){t&&0===t.code&&t.data&&(document.title=t.data.name)}),Promise.all([Global.loadUserInfo(),s.default.init()]).then(function(){App.skinModule.init(),App.ScrollModule.init(function(){(new l.default).init()}),App.MsgModule.init(),App.MsgFormModule.init(),App.FaceModule.init($(".j_popFacePanel"),$("#txt")),App.RBModule.init(),App.SpamScreenModule.init(),App.UserBoxModule.init(),App.GiftModule.init(),App.DsModule.init(),d.default.connect({chatId:Global.merchantId,callback:function(t){App.MsgModule.appendData(t)}})})})})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.skinModule={data:[{url:"http://img.wemew.com/wemew/wechat/images/newMy_skin_sky.png",text:"星空"},{url:"http://img.wemew.com/wemew/wechat/images/newMy_skin_night.png",text:"雨夜"},{url:"http://img.wemew.com/wemew/wechat/images/newMy_skin_magic.png",text:"魔法"}],sel:0,_init:function(){var t=localStorage.getItem("_skinBg");t=null==t?3:t,this.change(t)},init:function(){var t=localStorage.getItem("skinBg");t=null==t?0:t,this.change(t)},change:function(t){this.sel=t,localStorage.setItem("skinBg",t),t=0==t?"skinBg-sky":1==t?"skinBg-night":"skinBg-magic",$("body").removeClass("skinBg-sky skinBg-night skinBg-magic").addClass(t)},show:function(){var t='<div class="FuckUser">';t+='<div class="FuckHead">皮肤<a class="FuckYou_close"></a></div>',t+="",t+="</div>",t+='<div class="skin-img">',t+='<a><img src="'+allImageUrl+'skinSky-sel.png" /><i class="skin-sel"></i><p>星空</p></a>',t+='<a><img src="'+allImageUrl+'skinNight-sel.png" /><i class="skin-sel"></i><p>雨夜</p></a>',t+='<a><img src="'+allImageUrl+'skinMagic-sel.png" /><i class="skin-sel"></i><p>魔法</p></a>',t+="</div>",WM.Phone.get({type:"slideBox",position:"absolute",style:{padding:0},hasFoot:!1,html:t,ready:function(){var t=this;this.find(".wm_slideBody").css({padding:0,"border-radius":"4px 4px 0 0"}),this.find(".FuckYou_close").bind("click",function(){t.close()}),null!=skin.sel&&this.find(".skin-img a").eq(skin.sel).addClass("sel-skin"),this.find(".skin-img a").bind("click",function(){if($(this).hasClass("sel-skin"))return t.close();t.find(".sel-skin").removeClass("sel-skin"),$(this).addClass("sel-skin"),skin.change($(this).index()),t.close()})}})}},e.default=App.skinModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),a=function(t){return t&&t.__esModule?t:{default:t}}(n);App.DsModule={artistList:null,dtd:new $.Deferred,dsParams:null,minSlider:4,init:function(t){var e=this;$(".j_showDsPanel").on("click",function(){e.create($(this))}),this.ajaxArtistList()},create:function(t){var e=this,i='<div class="group_scroll">                        <div class="one_group sel"><span class="group_name">艺人</span>                        <span class="group_line"></span>                        </div>                    </div>';i+='<div class="art_user" id="art_user"></div>',Promise.all([App.GiftModule.getAllGiftHtml(),this.dtd]).then(function(t){var n=t[0];if(!n)return App.showInfo("打赏礼物暂不可用，请稍后重试");i+=n,i+='<div style="margin-top:8px" id="dsWordBox"><input type="text" class="inputNormal" id="dsWord" maxlength="60" placeholder="请输入打赏上墙语，30字以内" style="font-size:13px; text-indent:14px; box-sizing:border-box; height:40px; line-height:41px; padding:0px" /></div>',i+='<div id="j_priceBox"></div>';e.dsParams={};var s=WM.Phone.get({type:"slideBox",title:"打赏",html:i,btnText:"购买打赏",ready:function(){this.swiper=null,this.find(".wm_slideBody").css({"padding-top":0}),this.find(".one_group").eq(0).addClass("sel");var t=e.create_user();this.find("#art_user").html($(t)),a.default.createDom(this.find("#j_priceBox")),this.swiper=new Swiper("#swiper1",{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflow:{rotate:0,stretch:0,depth:100,modifier:0,slideShadows:!0}}),this.find(".oneDsObj").bind("click",function(){$(this).hasClass("sel")||$(this.parentNode).find(".oneDsObj").removeClass("sel").attr({"data-num":0}),$(this).addClass("sel").attr({"data-num":1}).find(".oneDsObjNum").html(1);var t=1*+$(this).attr("data-price");a.default.updatePay(t),e.dsParams.goodsId=$(this).attr("data-id")}),this.find(".j_artistHead").on("click",function(){e.showImages(this)})},click:function(){var t=$.trim(this.find(".swiper-slide1.swiper-slide-active").attr("art_id")),i=$.trim(this.find("#dsWord").val()),n=e.dsParams.goodsId,o=this;if(""==t||void 0===t)return showInfo("请选择打赏的艺人",!1,{top:"86%"});if(e.dsParams.userIdGiven=t,App.Utils.getTextLength(i)>30)return showInfo("上墙语不能超过30字",!1,{top:"86%"});if(!App.SensitiveModule.valide(i))return showInfo("请勿发布广告等不适内容",!1,{top:"86%"});if(""==n||void 0===n)return showInfo("请选择礼物",!1,{top:"86%"});e.dsParams.content=i.replace(/</g,"&lt;").replace(/>/g,"&gt;");var l=this.getButton()[0];WM.Phone.setButton(l,!1),this.cover(!0),e.ajaxDsMsg(e.dsParams).done(function(t){t&&0===t.code&&t.data&&t.data.banlanceEnough?(a.default.updateBalance(),s.close(),t.data.barrageInfo&&App.MsgModule.appendData(t.data.barrageInfo)):t&&0===t.code&&t.data&&!t.data.banlanceEnough?a.default.requireEncharge(t.data.minRechargeAmount,t.data.wechatMpPrePay.wxPayMpOrderResult):App.showInfo("操作失败",!1,{top:"86%"})}).fail(function(t){App.showInfo(t&&t.message||"操作失败",!1,{top:"86%"})}).always(function(){WM.Phone.setButton(l,!0),o.cover(!1)})},onClose:function(){null!=this.swiper&&this.swiper.destroy(!1)}})})},ajaxDsMsg:function(t){return $.ajax({url:Global.API_BASE+"/h5/give",method:"POST",dataType:"json",data:$.extend(t,{merchantId:Global.merchantId,giveType:App.GiftModule.GIVE_TYPE.PUBLIC})})},ajaxArtistList:function(){var t=this;return $.getJSON(Global.API_BASE+"/h5/getArtistList",{merchantId:Global.merchantId}).then(function(e){e&&0===e.code?(t.artistList=e.data,t.dtd.resolve(e.data)):t.dtd.reject("艺人列表获取失败")},function(){t.dtd.reject("艺人列表获取失败")}),this.dtd},setImages:function(t){var e=$(t);if(e.width()/e.height()<=.72){e.css({width:"100%",height:"auto",left:0});var i=(e.height()-125)/-2;e.css({top:i,visibility:"visible"})}else{e.css({height:"100%",width:"auto",top:0});var n=(e.width()-90)/-2;e.css({left:n,visibility:"visible"})}},showImages:function(t,e){if($(t).parents(".swiper-slide1").hasClass("swiper-slide-active")){var i=$(t).attr("src");WM.Phone.showImage(i)}},create_user:function(){var t=this.artistList,e=(t.length,this.minSlider,"");e+='<div class="swiper-container swiper1" id="swiper1">',e+='<div class="swiper-wrapper swiper-container-less">';for(var i=0;i<t.length;i++){var n=t[i],a=n.name;a=null==n.type||void 0===n.type?n.name:n.type+"-"+n.name,e+='<div class="swiper-slide swiper-slide1" art_id="'+n.userId+'">',e+='<img class="art_user_head j_artistHead" src="'+n.imgUrl+'" onload="App.DsModule.setImages(this)" />',e+='<div class="art_user_name">'+a+"</div>",e+="</div>"}return e+="</div></div>"}},e.default=App.DsModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),a=function(t){return t&&t.__esModule?t:{default:t}}(n);App.SpamScreenModule={bpThemes:null,bpTimes:null,init:function(){var t=this;$(".j_showSparmPanel").on("click",function(){t.showPanel($(this))})},ajaxBpTimes:function(){return this.bpTimes?Promise.resolve(this.bpTimes):$.ajax({url:Global.API_BASE+"/h5/priceTimeInfo",data:{merchantId:Global.merchantId},dataType:"json"}).then(function(t){return t&&0===t.code?t.data:null})},bpParams:{},showPanel:function(t,e){if(e)var i=t.closest(".j_row").attr("mid"),n=t.closest(".j_row").find(".j_pic").attr("src");Promise.all([this.ajaxBpTheme(),this.ajaxBpTimes()]).then(function(t){this.bpThemes=t[0],this.bpTimes=t[1];var s=template("spamPanelTpl",{bpTimes:this.bpTimes,bpThemes:this.bpThemes,isForTa:e,pic:n}),o=this,l=WM.Phone.get({type:"slideBox",title:e?"以下图片将霸屏显示":"霸屏",btnText:"购买霸屏",html:s,onload:function(){a.default.createDom(this.find("#j_priceBox"))},ready:function(){o.bpParams={times:this.find("#select").val()},e&&(o.bpParams.messageId=i);var t=this;this.find(".wm_slideFoot .btnNormal").css({margin:0}),this.find(".wm_slideBody").css({"overflow-x":"inherit"}),this.find("#select").on("change",function(){var e=+$(this).val(),i=$(this).find("option:selected").text();if(t.find("#bpText1").html(i).attr("data-num",e),o.bpParams.times=e,0!=t.find(".oneBpTime.sel").length){var n=t.find(".oneBpTime.sel").attr("data-price");n=parseFloat(n);var s=n*e;a.default.updatePay(s)}}),this.find(".oneBpTime").click(function(){if($(this).hasClass("BpTimeNotCheck"))return showInfo("该时长管理员不可选，可登录微喵后台取消该限制",!1);$(this).addClass("sel").siblings(".oneBpTime").removeClass("sel");var e=$(this).attr("data-price"),i=$(this).attr("data-time");i=void 0==i?0:i,i<30&&t.find(".oneBpType").removeClass("sel"),e=parseFloat(e);var n=e*o.bpParams.times;a.default.updatePay(n),o.bpParams.second=i}),this.find(".oneBpType").on("click",function(){if(o.bpParams.second<30)return App.showInfo("霸屏时长大于30秒才可使用霸屏主题",!1);$(this).hasClass("sel")?($(this).removeClass("sel").siblings(".oneBpType").removeClass("sel"),delete o.bpParams.theme):($(this).addClass("sel").siblings(".oneBpType").removeClass("sel"),o.bpParams.theme=$(this).data("type"))}),o.$uploadBox=this.find(".j_uploadBox").on("click",".j_delImage",function(){o.delImage($(this))}),e||(o.uploadInstance=App.UploadModule.instance({$input:this.find(".j_file"),onStart:function(){o.showUploading()},onError:function(t){o.uploadError(res&&res.message)},onSuccess:function(t){t&&0===t.code&&t.data?o.uploadSuccess(t.data):o.uploadError(t&&t.message)}}))},onClose:function(){o.uploadInstance&&o.uploadInstance.clear()},click:function(t){var i=this;if(!o.bpParams.second)return App.showInfo("请选择霸屏时长",!1,{top:"86%"});var n=$(".oneUploadImg.show"),s=$(".oneUploadVideo"),r="";if(e){if(!(r=$.trim(i.find("#_bpWord").val())))return App.showInfo("请输入霸屏语",!1,{top:"86%"})}else if(r=$.trim(i.find("#_bpWord").val()),0==r.length&&0==n.length&&0==s.length)return App.showInfo("请输入霸屏语或者上传图片",!1,{top:"86%"});if(App.Utils.getTextLength(r)>40)return App.showInfo("霸屏上墙语不能超过40字",!1,{top:"86%"});if(r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;"),!App.SensitiveModule.valide(r))return showInfo("请勿发布广告等不适内容",!1,{top:"86%"});o.bpParams.content=r;var d=this.getButton()[0];WM.Phone.setButton(d,!1),this.cover(!0),o.ajaxBpMsg(o.bpParams,e).done(function(t){t&&0===t.code&&t.data&&t.data.banlanceEnough?(a.default.updateBalance(),App.MsgModule.appendData(t.data.barrageInfo,e),l.close()):t&&0===t.code&&t.data&&!t.data.banlanceEnough?a.default.requireEncharge(t.data.minRechargeAmount,t.data.wechatMpPrePay.wxPayMpOrderResult):App.showInfo("操作失败",!1,{top:"86%"})}).fail(function(t){App.showInfo(t&&t.message||"操作失败",!1,{top:"86%"})}).always(function(){WM.Phone.setButton(d,!0),i.cover(!1)})}})}.bind(this))},ajaxBpMsg:function(t,e){return $.ajax({url:e?"/h5/barping":"/h5/addBarping",method:"POST",dataType:"json",data:$.extend(t,{merchantId:Global.merchantId})})},ajaxBpTheme:function(){return this.bpThemes?Promise.resolve(this.bpThemes):$.ajax({url:"/h5/barpinThemes",method:"POST",dataType:"json",data:{merchantId:Global.merchantId}}).then(function(t){return t&&0===t.code?t.data:null})},showUploading:function(){delete this.bpParams.picUrl,this.$uploadBox.find(".j_loading").show()},uploadSuccess:function(t){this.bpParams.picUrl=t,this.$uploadBox.find(".j_loading").hide(),this.$uploadBox.append('<div class="oneUpload show"><a class="iconDeleBox j_delImage"><i class="iconDele"></i></a>            <img class="img" src="'+t+'" /></div>')},uploadError:function(t){App.showInfo(t||"上传失败",!1),this.$uploadBox.find(".j_loading").hide()},delImage:function(t){var e=this;WM.Phone.get({type:"confirm",title:"删除",innerHTML:"确定删除此图片?",click:function(i){e.uploadInstance.clear(),t.closest(".oneUpload").remove(),this.close(),delete e.bpParams.picUrl}})}},e.default=App.SpamScreenModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(0),a=function(t){return t&&t.__esModule?t:{default:t}}(n);App.RBModule={config:{poundage:.006,minNum:1,maxNum:500,minMoney:1,maxMoney:2e3,isInt:!1},init:function(){var t=this;$(".j_showRedBag").click(function(){t.showRedBag($(this))}),App.MsgModule.getCnt().on("click",".j_openRedBag",function(){t.show($(this))}),$(document).on("click",".j_closeRbBox",function(){t.close($(this))}).on("click",".j_goToResult",function(){t.gotoResult($(this))}).on("click",".j_chaiRedBag",function(){t.open($(this))})},check:function(){var t=this.config,e=$.trim($("#rgMoney").val()),i=$.trim($("#rgNum").val());if(0==e.length)return App.showInfo("请设置红包总金额",!1);if(e=parseFloat(e),null!=t.minMoney&&e<t.minMoney)return App.showInfo("红包总金额最少"+t.minMoney+"元",!1,{top:"86%"});if(null!=t.maxMoney&&e>t.maxMoney)return App.showInfo("红包总金额最多"+t.maxMoney+"元",!1,{top:"86%"});if(t.isInt){if(!/^[0-9]*[1-9][0-9]*$/.test(e))return App.showInfo("红包总金额必须为整数",!1,{top:"86%"})}if(0==i.length)return App.showInfo("请设置红包个数",!1,{top:"86%"});if(i=parseInt(i),null!=t.minNum&&i<t.minNum)return App.showInfo("红包个数最少"+t.minNum+"个",!1,{top:"86%"});if(null!=t.maxNum&&i>t.maxNum)return App.showInfo("红包个数最多"+t.maxNum+"个",!1,{top:"86%"});var n=parseInt(e);return!(n<i)||App.showInfo(e.toFixed(2)+"元最多只能发出 "+n+" 个红包",!1,{top:"86%"})},setPlacehoder:function(t){var e="红包个数";null!=t.minNum&&null!=t.maxNum?e+="，"+t.minNum+"-"+t.maxNum+"个":(null!=t.minNum&&(e+="，最少"+t.maxNum+"个"),null!=t.maxNum&&(e+="，最多"+t.maxNum+"个")),$("#rgNum").attr({placeholder:e})},showRedBag:function(){var t=this,e=this.config,i="总金额",n="红包个数";null!=e.minMoney&&null!=e.maxMoney?i+="，"+e.minMoney+"-"+e.maxMoney+"元":(null!=e.minMoney&&(i+="，最少"+e.minMoney+"元"),null!=e.maxMoney&&(i+="，最多"+e.maxMoney+"元")),null!=e.minNum&&null!=e.maxNum?n+="，"+e.minNum+"-"+e.maxNum+"个":(null!=e.minNum&&(n+="，最少"+e.minNum+"个"),null!=e.maxNum&&(n+="，最多"+e.maxNum+"个"));var s='<div style="margin:0 0 10px 0; font-size:12px; color:#999; padding-left:10px">红包金额大于10元将大屏幕显示</div>';s+='<div class="inputDiv"><input type="number" class="inputNormal _inputNormal" placeholder="'+i+'" style="border-radius:4px; font-size:13px;" id="rgMoney" oninput="if(value.length>8)value=value.slice(0,8)"><tt>元</tt></div>',s+='<div class="inputDiv" style="margin:10px 0 0 0; font-size:12px; color:#999; padding-left:10px">每人抽到的金额随机</div>',s+='<div class="inputDiv" style="margin:10px 0 20px 0"><input type="tel" class="inputNormal _inputNormal" placeholder="'+n+'" oninput="if(value.length>8)value=value.slice(0,5)" style="border-radius:4px; font-size:13px;" id="rgNum"><tt>个</tt></div>',s+='<div class="inputDiv" style="margin-bottom:5px"><input type="text" class="inputNormal _inputNormal" placeholder="留言，20字以内" maxlength="20" style="border-radius:4px; font-size:13px;" id="rgVal"></div>',s+='<div id="j_priceBox"></div>';this.infoPop=WM.Phone.get({type:"slideBox",title:"发红包",html:s,btnText:"塞钱进红包",ready:function(){this.find("#rgMoney").bind("input",function(){a.default.updatePay($.trim($(this).val())||0)}),this.find("#rgMoney").bind("input",function(){var e=$.trim($("#rgMoney").val());if(e.length>0){var i=parseFloat(e),n=parseInt(i);null!=t.config.maxNum&&t.config.maxNum<n&&(n=t.config.maxNum);var a={maxNum:n,minNum:t.config.minNum};t.setPlacehoder(a)}else t.setPlacehoder(t.config)}),a.default.createDom(this.find("#j_priceBox"))},click:function(){if(1==t.check()){var e=$.trim($("#rgVal").val());if(!App.SensitiveModule.valide(e))return App.showInfo("请勿发布广告等不适内容",!1,{top:"86%"});e=e.replace(/</g,"&lt;"),(e=e.replace(/>/g,"&gt;"))||(e="恭喜发财，大吉大利！");var i=$.trim($("#rgMoney").val()),n=$.trim($("#rgNum").val());WM.Phone.get({type:"confirm",title:"发红包",innerHTML:"确定支付 "+i+"元？",click:function(a){this.close(),a&&t.preCreate({amount:i,sendNumber:n,redPackageTitle:e})}})}}})},preCreate:function(t){var e=this;$.ajax({url:Global.API_BASE+"/h5/prepareCreateRedPackage",method:"POST",data:$.extend({merchantId:Global.merchantId},t)}).done(function(t){t&&0===t.code&&t.data?t.data.banlanceEnough?e.create(t.data):a.default.requireEncharge(t.data.minRechargeAmount,t.data.wechatMpPrePay.wxPayMpOrderResult):App.errorTip(t&&t.message||"红包发送失败")}).fail(App.errorTip("红包发送失败"))},create:function(t){var e=this;$.post(Global.API_BASE+"/h5/createRedPackage",{redPackageId:t.redPackageId}).done(function(t){t&&0===t.code?(App.MsgModule.appendData(t.data),e.infoPop.close()):App.errorTip(t&&t.message||"红包发送失败")}).fail(App.errorTip("红包发送失败"))},ajaxRedBag:function(t){return $.post(Global.API_BASE+"/h5/userOpenRedPackage",{redPackageId:t,merchantId:Global.merchantId}).then(function(t){if(t&&0===t.code&&t.data)return t.data.amount;App.errorTip(t&&t.message||"领取失败")}).fail(App.errorTip("领取失败"))},show:function(t){var e=t.closest(".j_row"),i=(e.attr("rbid"),e.attr("money")),n=new WM.Phone.waiting({text:"正在获取红包信息"});this.currRowEl=e;var a=this,s=new Image;s.onload=s.onerror=function(){if(null!=i&&void 0!==i&&((i=parseFloat(i))<0||i>0))return n.close(),void a._show(i,e);n.close(),a._show(0,e)},s.src=allImageUrl+"onWall_redBagBig.png"},_show:function(t,e){$("body").append(template("redBagOpenTpl",{money:t,userPic:e.find(".j_userInfo").attr("data-userpic"),name:e.find(".j_userInfo").attr("data-name"),info:e.find(".j_rbTitle").text(),rbId:e.attr("rbid"),rbPic:Global.allImageUrl+"onWall_redBagBig.png",chaiPic:Global.allImageUrl+"chai.png"}))},gotoResult:function(t){var e=$(t).attr("rbid");window.location.href="/cwechat/redBagDetail?redBagId="+e},open:function(t){var e=this,i=this.currRowEl;if(!$(t).hasClass("animate")){$(t).addClass("animate");(new Date).getTime();this.ajaxRedBag($(t).attr("rbid")).then(function(n){i.attr("money",n),setTimeout(function(){return $(t).fadeOut(function(){$(t).remove()}),null==n||0==n.length||0==n||-1==n?void $("#redBagBox .redBoxInfoResult").html("手慢了，红包已抢完了"):-2==n?void $("#redBagBox .redBoxInfoResult").html("对不起，红包已过期"):($("#redBagBox .redBoxInfoResult").hide(),$("#redBagBox .numDiv").show(),void e.moneyAnimate(n))},0)},function(e){$(t).removeClass("animate"),App.showInfo(e||"操作失败",!1)})}},close:function(t){$("#redBagBox").remove()},moneyAnimate:function(t){t=parseFloat(t),t=t.toFixed(2);for(var e="",i=0;i<t.length;i++)"."==t.charAt(i)?e+='<span class="tNum tPot" val="0"><tt>9</tt><tt>8</tt><tt>7</tt><tt>6</tt><tt>5</tt><tt>4</tt><tt>3</tt><tt>2</tt><tt>1</tt><tt>.</tt></span>':e+='<span class="tNum" val="'+t.charAt(i)+'"><tt>9</tt><tt>8</tt><tt>7</tt><tt>6</tt><tt>5</tt><tt>4</tt><tt>3</tt><tt>2</tt><tt>1</tt><tt>0</tt></span>';e+="<i>元</i>",$(e).appendTo($(".numDiv .numDivBox"));var n=$(".numDiv .tNum"),a=0,s=400;!function t(){var e=(n[a],parseInt($(n[a]).attr("val"))),i=50*(e+1)-500;s=s<=100?100:s,Transition.go({obj:n[a],style:{transform:"translate(0,"+i+"px)"},time:50,callback:function(){}}),++a<n.length&&setTimeout(function(){t()},40)}()}},e.default=App.RBModule},function(t,e){}]);