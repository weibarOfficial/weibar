!function(t){function e(a){if(i[a])return i[a].exports;var n=i[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,a){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="//www.yylive.com/static/",e(e.s=20)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={data:{balance:0},init:function(){return this.loadData()},loadData:function(){var t=this;return $.post("/h5/getUserBalance").then(function(e){e&&0===e.code&&e.data&&(t.data.balance=e.data.balance)})},total:function(){return this.data.balance},add:function(t){this.data.balance+=t},sub:function(t){this.data.balance=Math.max(this.data.balance-t,0),this.data.balance=+this.data.balance.toFixed(2)},createDom:function(t){var e=this.data.balance,i='<div id="priceBox" data-wxpay="0" class="moneyChecked">\n                        <div class="myRedBagBox">\n                            <div class="myRedBagTxt j_isChecked">\n                                <span class="myCheckBlack"></span>\n                                <span class="myCheckText">账户余额：￥<span id="j_balance">'+e+'元</span>\n                                </span>\n                            </div>\n                            <div class="myRedBagTxt j_delMoney" style="text-align:right"></div>\n                        </div>\n                        <div class="lineDiv">需微信支付</div>\n                        <div class="lineDiv" id="price">￥<span  id="j_price">0</span></div>\n                    </div>';t.html(i),t.find(".j_isChecked").on("click",function(){var t=$(this).closest("#priceBox");if(t.toggleClass("moneyChecked"),t.hasClass("moneyChecked")){var e=Math.max(t.data("allprice")-balanceTotal,0);t.data("wxpay",e),$("#j_price").html(e.toFixed(2))}else $("#j_price").html(t.data("allprice").toFixed(2))})},updatePay:function(t){t=Math.max(t,0),t=+Number(t).toFixed(2);var e=$("#priceBox");e.data("allprice",t),e.find(".j_delMoney").html("-"+t+"元");var i=0;i=e.hasClass("moneyChecked")?this.data.balance-t>=0?0:t-this.data.balance:t,e.data("wxpay",i),$("#j_price").html(i.toFixed(2))},updateBalance:function(){this.sub($("#priceBox").data("allprice"))},requireEncharge:function(t,e){WM.Phone.get({type:"confirm",title:"支付确认",innerHTML:"您的账户余额已不足,还需支付"+t+"元，是否前往微信支付？",click:function(t){this.close(),t&&(sessionStorage.setItem(Global.SESSION_KEY_WX_PAY,JSON.stringify(e)),window.location.href="./pay.html?returnurl="+encodeURIComponent(document.location.href))}})},directEncharge:function(t){WM.Phone.get({type:"confirm",title:"余额不足",innerHTML:"是否前往微信支付？充值金额 "+t+"元？",click:function(e){this.close(),e&&(window.location.href="./pay.html?amount="+100*t+"&returnurl="+encodeURIComponent(document.location.href))}})},jumpEncharge:function(t){window.location.href="./pay.html?amount="+100*t+"&returnurl="+encodeURIComponent(document.location.href)}};e.default=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),window.App||(window.App={}),window.allImageUrl="./images/",window.Global={SESSION_KEY_WX_PAY:"SESSION_KEY_WX_PAY",allImageUrl:allImageUrl,API_BASE:"",WS_BASE:"http://120.79.15.148:8080",merchantId:App.Utils.urlParam("merchantId")||1,chatId:null,User:{nickname:"app测试",userId:"1511958518205",scopeLevel:3,sex:"男",userPicture:""},login:function(){return this.DEBUG?$.getJSON(Global.API_BASE+"/test/loginByOpenId",{openId:Global.openId}):Promise.resolve()},loadUserInfo:function(){return $.getJSON("/h5/getUserInfo").then(function(t){t&&0===t.code&&$.extend(Global.User,t.data)})},getChatId:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Global.talkToId;return $.post("/h5/getChatId?toUserId="+t).then(function(t){if(t&&0===t.code)return Global.chatId=t.data,t.data;App.showInfo("获取chatId失败",!1)})}},App.errorTip=function(t){return function(e){App.showInfo(e&&e.message||t||"操作失败，请重试。",!1)}},/MicroMessenger/i.test(navigator.userAgent)||(Global.DEBUG=!0,Global.openId=App.Utils.urlParam("openId")||"ouc82xNQp2oQstpR6g9MD0Dtjupw"),e.default=window.Global},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.BasicFilter=function(){return function(t){t._sexCls="男"===(t.sex||t.fromSex)?"man":"woman",t._isSelf=t.fromUserId==Global.User.userId||t.userId==Global.User.userId,t._ownerCls=t._isSelf?"myTxt":"other",t._timeStr=App.Utils.fmDate(t.createTime,"MM-DD hh:mm"),t._hasTextCls=t.content?"hasText":"";var e=t.msgImgUrl&&t.msgImgUrl.split("|");return e&&e.length>1&&(t._imgArr=e),e&&!t._isSelf&&t.status===App.MsgModule.STATUS.NOT_BA&&t.type!==App.MsgModule.MSG_TYPE.GIVE?t._forTaBp=!0:t._hideLineCls="f-hidden",t.content?t.content=App.FaceModule.replaceText(t.content):t.message&&(t.message=App.FaceModule.replaceText(t.message)),t}}(),e.default=ApplicationCache.BasicFilter},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.UploadModule=function(){function t(t,e){var i=$.Deferred(),a=null;if(e.width=null==e.width?0:e.width,e.height=null==e.height?0:e.height,t){if(!/^(image\/jpeg|image\/png)$/i.test(t.type)&&""!=t.type)return void i.reject("请选择jpeg、png格式的图片");EXIF.getData(t,function(){EXIF.getAllTags(this),a=+EXIF.getTag(this,"Orientation")}),i.notify();var n=new FileReader;n.onload=function(t){var n=new Image;n.src=t.target.result,n.onerror=function(){i.reject("当前文件不可用，请重新选择")},n.onload=function(){var t=this.naturalWidth,n=this.naturalHeight;if(t<e.width||n<e.height)return void i.reject("请上传宽度大于"+e.width+"px，高度大于"+e.height+"px 的图片");this.naturalWidth>this.naturalHeight&&this.naturalWidth>800?(t=800,n=t*this.naturalHeight/this.naturalWidth):this.naturalHeight>this.naturalWidth&&this.naturalHeight>1200&&(n=1200,t=n*this.naturalWidth/this.naturalHeight);var o=document.createElement("canvas"),s=o.getContext("2d");if(o.width=t,o.height=n,a&&1!=a)switch(a){case 6:o.width=n,o.height=t,s.rotate(Math.PI/2),s.drawImage(this,0,-n,t,n);break;case 3:s.rotate(Math.PI),s.drawImage(this,-t,-n,t,n);break;case 8:o.width=n,o.height=t,s.rotate(3*Math.PI/2),s.drawImage(this,-t,0,t,n)}else s.drawImage(this,0,0,t,n);var l=o.toDataURL("image/jpeg",.8);i.resolve(l)}},n.readAsDataURL(t)}else i.reject("未指定上传文件");return i}function e(t){this.config=$.extend({},{url:"/h5/uploadPic",base64:!0,$input:null,filename:"file",data:null,num:1,width:200,height:200,size:1024e4,onStart:null,onSuccess:null,onError:null},t),this.init()}return e.prototype={init:function(){this.initEvents(),this.config.url=this.config.base64?"/h5/uploadPicBase64":"/h5/uploadPic"},initEvents:function(){var t=this;this.config.$input.on("change",function(){t.upload(this.files)})},upload:function(e){var i=this,a=e[0];if(a.size>this.config.size)return App.showInfo("上传图片不能大于"+this.config.size/1024e3+"M",!1),!1;this.config.base64?t(a,{width:this.config.width,height:this.config.height}).progress(function(){i.config.onStart&&i.config.onStart()}).then(function(t){this.start(t)}.bind(this),function(t){i.config.onError&&i.config.onError({message:t})}):(this.config.onStart&&this.config.onStart(),this.start(a))},start:function(t){var e=this,i={url:this.config.url,type:"POST",cache:!1,data:{}};if(this.config.base64)$.extend(i.data,this.config.data),i.data[this.config.filename]=t.replace("data:image/jpeg;base64,","");else{i.processData=!1,i.contentType=!1;var a=new FormData;if(this.config.data)for(var n in this.config.data)a.append(n,this.config.data[n]);a.append(this.config.filename,t),i.data=a}this.currUpload=$.ajax(i).done(function(t){e.config.onSuccess&&e.config.onSuccess(t)}).fail(function(t){try{e.config.onError&&e.config.onError(JSON.parse(t))}catch(i){e.config.onError&&e.config.onError(t)}}).always(function(){e.currUpload=null})},clear:function(){try{this.currUpload.abort()}catch(t){}}},{init:function(){},instance:function(t){return new e(t)}}}(),e.default=ApplicationCache.UploadModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.SensitiveModule=function(){var t=["江泽民","枪支弹药","我操"];return{valide:function(e){var i=!0;return $.each(t,function(t,a){if(e&&-1!==e.indexOf(a))return i=!1}),i},filter:function(e){return t.forEach(function(t){e&&(e=e.replace(new RegExp(t,"gi"),"*"))}),e}}}(),e.default=App.SensitiveModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.ScrollModule={len:300,delay:100,animateTime:150,timeout:null,top:0,init:function(t){var e=this;$(window).bind("scroll",function(){e.top=$(window).scrollTop()}),setTimeout(function(){$("html,body").stop().animate({scrollTop:$(document).height()-$(window).height()},e.animateTime),t&&setTimeout(function(){t()},e.animateTime)},500)},down:function(t){var e=this;t=!1!==t;try{clearTimeout(this.timeout)}catch(t){}this.timeout=setTimeout(function(){var i=$(document).height()-$(window).height();(t||i-e.top<=e.len)&&$("html,body").stop().animate({scrollTop:i},e.animateTime)},this.delay)}},e.default=App.ScrollModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),App.UserBoxModule={$box:null,imageLoad:!1,imageData:[],ready:!0,ajaxLoad:!1,swiper:null,loadNum:3,options:{fromDetail:!1},init:function(t){$.extend(this.options,t);var e=this;this.$box=$(".j_userBox").on("click",function(){e.close()}).on("click",".j_sendGift",function(){App.GiftModule.showGiftPanel(e.currEl)}).on("click",".j_talkTo",function(t){t.preventDefault();var i=(e.currEl.attr("data-name"),e.currEl.attr("data-uid")),a=(e.currEl.attr("data-userpic"),Global.merchantId);location.href="./talk.html?uid="+i+"&merchantId="+a}),App.MsgModule.getCnt().on("click",".j_popProfile",function(t){return t.preventDefault(),e.show($(this)),!1})},reset:function(){this.imageLoad=!1,this.ajaxLoad=!1,this.imageData=[],this.$box.find(".userBoxAllBg").html("");try{this.swiper.destroy(!0)}catch(t){}},setImages:function(t){for(var e=WM.Phone.loading.getHtml(),i=$("#swiper-container1 .swiper-slide"),a=Array.prototype.slice.call(i,t,t+this.loadNum),n=0;n<a.length;n++)$(a[n]).hasClass("loaded")||($(e).insertBefore($(a[n]).find(".userBg")),$(a[n]).addClass("loaded"),$(a[n]).find("img").attr({src:$(a[n]).find("img").attr("_src")}))},imgLoad:function(t){$(t.parentNode).find(".Phone_loading").remove(),$(t.parentNode).find(".reflectionBox").css({visibility:"visible"}),$(t.parentNode).find("img").css({visibility:"visible"})},load:function(t){this.imageLoad=!0,this.initImageList()},showAll:function(){$(".userBox .firstSlide").find(".reflectionBox").css({visibility:"visible"}),$(".userBox .firstSlide").find("img").css({visibility:"visible"}),$(".userBox>.Phone_loading").hide(),$(".userBox").find(".userInfo").show()},initImageList:function(){if(this.imageLoad&&this.ajaxLoad){this.imageLoad=!1,this.ajaxLoad=!1;for(var t=this.imageData,e="",i=0;i<t.length;i++)e+=this.create(t[i]);$(e).appendTo($("#swiper-container1 .swiper-wrapper")),this.initSwiper(),this.showAll(),this.setImages(0)}},initSwiper:function(){var t=$(".swiper-slide").length,e=this;this.swiper=new Swiper("#swiper-container1",{paginationType:$(".swiper-slide").length>0?"fraction":"bullets",onTransitionStart:function(t){(t.activeIndex+1)%e.loadNum==0&&e.setImages(t.activeIndex+1)},onInit:function(){if(t<=1)return void $("#userTipIndex").html("");$("#userTipIndex").html("1/"+t+"&nbsp;&nbsp;")},onSlideChangeEnd:function(e){t<=1||$("#userTipIndex").html(e.activeIndex+1+"/"+t+"&nbsp;&nbsp;")}})},close:function(){try{getUserImage.abort()}catch(t){}$(".userBox").hide(),this.reset(),$(".userBoxAllBg").html("")},create:function(t,e){return e?'<div class="swiper-slide firstSlide loaded"><img src="'+t+'" class="userBg"                  onload="App.UserBoxModule.load(this)" onerror="App.UserBoxModule.load(this)"/>                 <div class="reflectionBox"><img class="reflection" src="'+t+'" /></div></div>':'<div class="swiper-slide"><img _src="'+t+'" class="userBg beforeLoad"             onerror="App.UserBoxModule.imgLoad(this)" onload="App.UserBoxModule.imgLoad(this)" />            <div class="reflectionBox"><img class="reflection beforeLoad" _src="'+t+'" /></div></div>'},show:function(t){this.reset(),this.currEl=t;var e=t.attr("data-src")||"",i=t.attr("data-name")||"",a=t.attr("data-sex")||"",n=t.attr("data-age")||"",o=t.attr("data-cm")||"",s=t.attr("data-kg")||"",l=t.attr("data-job")||"",r=t.attr("data-txt")||"",c=t.attr("data-uid")||"",d=(t.attr("data-url"),t.attr("gradeColor")||""),u=t.attr("gradeName")||"",h=t.attr("data-userpic")||"";t.attr("gradeclass"),t.attr("gradeImg");if(0===this.$box.find(".Phone_loading").length){var p=WM.Phone.loading.getHtml();$(p).appendTo(this.$box)}else this.$box.find(".Phone_loading").show();var f='<div class="swiper-container" id="swiper-container1"><div class="swiper-wrapper">';f+=this.create(e,!0),f+='</div><div class="swiper-pagination" id="swiper-pagination1" style="position:absolute; bottom:10px;">&nbsp;</div></div>',$(".userBoxAllBg").html(f),$(".userInfo .grade_change").html(""),$(".userInfo .grade_change").append("<img src="+h+' class="cy_userH" width="40px"/>'),"qt_color"!=d&&null!=u&&""!=u&&$(".userInfo .grade_change").append("<p class="+d+">"+u+"</p>"),$(".userInfo .p1").html(i+'<span class="'+("男"==a?"man":"woman")+'">'+a+"</span>");var m="";null!=n&&""!=n&&(m+="<span>"+n+"岁&nbsp;&nbsp;/&nbsp;&nbsp;</span>"),null!=o&&""!=o&&(m+="<span>"+o+"Cm&nbsp;&nbsp;/&nbsp;&nbsp;</span>"),null!=s&&""!=s&&(m+="<span>"+s+"Kg&nbsp;&nbsp;/&nbsp;&nbsp;</span>"),null!=l&&""!=l&&(m+="<span>"+l+"</span>"),$(".userInfo .p2").html(m+'<p style="clear:both"></p>'),r=r||"",$(".userInfo .p3").html(r),!0!==this.options.fromDetail&&(Global.User.userId==c||(m=!0!==Global.isshutup?'<div><a class="j_talkTo">私信</a></div><div><a  class="j_sendGift">送礼物</a></div>':'<div><a class="only j_sendGift">送礼物</a></div>',$(".userInfo .aBox").html(m))),$(".userBox").show();var g=this;g.ajax_getUserImage().done(function(t){g.imageData=t,g.initImageList()}).fail(function(){g.imageData=[]}).always(function(){g.ajaxLoad=!0})},ajax_getUserImage:function(t){return(new $.Deferred).resolve([])}},e.default=App.UserBoxModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={faceUrl:"./images/faces/",newFace:{ic_emoji_666:"[666]",ic_emoji_bishi:"[鄙视你]",ic_emoji_bukaixin:"[不开心]",ic_emoji_dai:"[呆]",ic_emoji_haixiu:"[害羞]",ic_emoji_huaji:"[滑稽]",ic_emoji_keai:"[可爱]",ic_emoji_kelian:"[可怜]",ic_emoji_ku:"[哭]",ic_emoji_liulei:"[流泪]",ic_emoji_memeda:"[么么哒]",ic_emoji_mengbi:"[懵逼]",ic_emoji_nu:"[怒]",ic_emoji_se:"[色]",ic_emoji_shuai:"[衰]",ic_emoji_tanqi:"[叹气]",ic_emoji_tiaopi:"[调皮]",ic_emoji_wabizi:"[挖鼻子]",ic_emoji_weiqu:"[很委屈]",ic_emoji_weixiao:"[微笑]",ic_emoji_wulian:"[捂脸]",ic_emoji_wuzui:"[捂嘴]",ic_emoji_xiao:"[笑]",ic_emoji_xiaoku:"[笑哭]",ic_emoji_yun:"[晕]",ic_emoji_zaijian:"[再见了]",ic_emoji_zhuakuang:"[抓狂]"},init:function(t,e){this.$input=e,this.$trigger=t,this.initDom(),this.initEvent()},initDom:function(){var t="",e=0,i=!1;for(var a in this.newFace)e%7==0&&(t+="<div>",i=!0),t+='<a index="'+a+'" class="j_addFace"><img src="'+this.faceUrl+a+'.png" /></a>',(e+1)%7==0&&(t+="</div>",i=!1),e++;if(i){for(;e%7!=0;)t+="<a></a>",e++;t+="</div>"}$("#allFace").html(t+'<div style="clear:both"></div>')},initEvent:function(){var t=this;this.$trigger.on("click",function(){t.show()}),this.$cnt=$("#allFace").on("click",".j_addFace",function(){t.setFace($(this))})},show:function(){$("#allFace").hasClass("hide")?($("#allFace").removeClass("hide"),$(window).bind("mousedown.face",function(t){var e=t.target;"txt"!=e.id&&"allFace"!=e.id&&($("#allFace").find(e).length>0||($(window).unbind("mousedown.face"),setTimeout(function(){$("#allFace").addClass("hide")},250)))})):this.closeFace()},closeFace:function(){$(window).unbind("mousedown.face"),$("#allFace").addClass("hide")},insertHtml:function(t){this.isShow(!1);var e=this.$input[0];if(document.selection){document.selection.createRange().text=t,this.$input.blur()}else if("number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd){var i=e.selectionStart,a=e.selectionEnd,n=i,o=e.value;e.value=o.substring(0,i)+t+o.substring(a,o.length),n+=t.length,e.selectionStart=e.selectionEnd=n,this.$input.blur()}else e.value+=t,this.$input.blur();this.isShow(!0)},isShow:function(t){t?$(".wallHead,.fixedIcon").css("display","block"):$(".wallHead,.fixedIcon").css("display","none")},setFace:function(t){var e=this.newFace[$(t).attr("index")];this.insertHtml(e)},replaceText:function(t){if(t){var e=this.newFace;for(var i in e)for(;-1!=t.indexOf(e[i]);)t=t.replace(e[i],'<img class="emoji_face" src="'+this.faceUrl+i+'.png" />');return t}return""}};e.default=App.FaceModule=a},function(t,e,i){"use strict";function a(t){t&&t.fromDetail?this.ajaxLoadFn="_ajaxLoadDetail":this.ajaxLoadFn="ajaxLoad",this.options=$.extend({activeTimer:!1,params:null},t)}Object.defineProperty(e,"__esModule",{value:!0}),a.prototype={hasMore:!0,loading:!1,pageCount:20,nowPage:1,preTimestamp:null,nextTimestamp:null,$loadingEl:null,init:function(){var t=this;this.$loadingEl=$(".loadMore"),this.initTip=new WM.Phone.waiting({text:"正在为您加载",hasCover:!1,clickClose:!1}),$(window).scroll(function(){$(window).scrollTop()<=10&&t.loadPrevious()}),this.firstLoad()},startTimer:function(){var t=this;this.options.activeTimer&&(this.timer=setInterval(function(){t.loadNext()},5e3))},loadNext:function(){var t=this;this[this.ajaxLoadFn]({beginTime:this.nextTimestamp}).then(function(e){e&&0===e.code&&e.data&&e.data.length&&(t.nextTimestamp=e.data[e.data.length-1].createTime,App.MsgModule.appendData(e.data))},function(t){}).always(function(){})},loadPrevious:function(){var t=this;if(!this.loading){if(!this.hasMore)return this.$loadingEl.find("tt").html("没有更多了"),void this.$loadingEl.show().removeClass("animate");this.$loadingEl.find("tt").html("正在为您加载"),this.$loadingEl.show(),this.loading=!0,this[this.ajaxLoadFn]({endTime:this.preTimestamp}).then(function(e){e&&0===e.code?(t.checkData(e.data),App.MsgModule.prependData(e.data)):App.showInfo(e&&e.message||"加载失败",!1)},function(t){App.showInfo(t&&t.message||"加载失败",!1)}).always(function(){t.$loadingEl.hide(),t.loading=!1})}},checkData:function(t){return t&&t.length||(this.hasMore=!1),t.length&&(this.preTimestamp=t[0].createTime,this.nextTimestamp||(this.nextTimestamp=t[t.length-1].createTime)),t},firstLoad:function(){var t=this;this.loading=!0,this[this.ajaxLoadFn]({endTime:Date.now()}).then(function(e){e&&0===e.code?(t.checkData(e.data),App.MsgModule.appendData(e.data),t.initTip.close(),t.startTimer()):App.showInfo(e&&e.message||"加载失败",!1)},function(e){WM.Phone.get({type:"alert",innerHTML:e&&e.message||"加载失败，请点击确定重试",click:function(){this.close(),t.firstLoad()}})}).always(function(){t.loading=!1})},ajaxLoad:function(t){return t.count=this.pageCount,t.merchantId=Global.merchantId,$.ajax({url:"/h5/barrageList",data:t,dataType:"json",method:"POST"})},_ajaxLoadDetail:function(t){return t.count=this.pageCount,t.toUserId=Global.talkToId,t.chatId=Global.chatId,$.ajax({url:"/h5/chatList",data:t,dataType:"json",method:"POST"})}},App.LoadModule=a,e.default=App.LoadModule},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i(0),n=function(t){return t&&t.__esModule?t:{default:t}}(a);App.GiftModule={dtd:new $.Deferred,data:null,options:{fromDetail:!1,params:null},GIVE_TYPE:{PUBLIC:1,PRIVITE:2},init:function(t){var e=this;$.extend(this.options,t),this.loadData(),this.options.fromDetail?(this.options.giveType=this.GIVE_TYPE.PRIVITE,t.$triggerEl&&t.$triggerEl.on("click",function(){e.showGiftPanel($(this))})):this.options.giveType=this.GIVE_TYPE.PUBLIC},loadData:function(){var t=this;$.ajax({url:Global.API_BASE+"/h5/goodsSettingInfo",data:{merchantId:Global.merchantId},dataType:"json"}).done(function(e){e&&0===e.code?(t.data=e.data,t.dtd.resolve(e.data)):t.dtd.reject(e&&e.message||"礼物加载失败")}).fail(function(e){t.dtd.reject(e&&e.message||"礼物加载失败")})},getData:function(){return this.dtd},getAllGiftHtml:function(){return this.getData().then(function(t){var e="";return e+='<div class="wm_slideRowTitle" style="padding:0;margin:5px 0;">礼物</div>',e+='<div class="wm_otherBar" style="padding:0;margin:5px 0;">                        <div class="dsObjMain" style="padding:0;margin:0;">                            <div class="dsObjBox dsObjBox2">',t.forEach(function(t){e+='<a class="oneDsObj" data-id="'+t.goodsId+'" data-price="'+t.goodsAmount+'">                            <span class="oneDsObjSpan"><img src="'+t.goodsImgUrl+'" style="max-width:100%"/></span>                            <tt class="ellipsis">'+t.goodsName+'</tt>                            <tt class="ellipsis" style="margin-top:0;height:12px;line-height:12px;">￥'+t.goodsAmount+'</tt><i class="oneDsObjNum"></i></a>'}),e+="</div></div></div>"},function(){return null})},showGiftPanel:function(t){var e=this,i=t.attr("data-userpic")||"",a=t.attr("data-name")||"",o=t.attr("data-uid")||"",s='<div style="text-align:center">                        <img src="'+i+'" style="border-radius:4px; width:60px; height:60px" />                        <p style="margin-top:5px;">'+a+"</p>                    </div>";this.getAllGiftHtml().then(function(t){if(!t)return App.showInfo("打赏礼物暂不可用，请稍后重试");s+=t,s+='<div style="margin-top:8px" id="dsWordBox"><input type="text" class="inputNormal" id="dsWord" maxlength="60" placeholder="留言，30字以内" style="font-size:13px; text-indent:14px; box-sizing:border-box; height:40px; line-height:41px; padding:0px" /></div>',e.options.fromDetail||(s+='<a class="isShowToPc sel"><i class="icon_gift_select"></i>在大屏幕上显示</a>'),s+='<div id="j_priceBox"></div>';e.dsParams={userIdGiven:o};var i=WM.Phone.get({type:"slideBox",title:"送礼物",html:s,btnText:"购买礼物",ready:function(){this.find(".wm_slideBody").css({"padding-top":0}),this.find(".oneDsObj").bind("click",function(){$(this).hasClass("sel")||$(this.parentNode).find(".oneDsObj").removeClass("sel").attr({"data-num":0}),$(this).addClass("sel").attr({"data-num":1}).find(".oneDsObjNum").html(1);var t=1*$.trim($(this).attr("data-price"));n.default.updatePay(t),e.dsParams.goodsId=$(this).attr("data-id")}),this.find(".isShowToPc").bind("click",function(){if($(this).hasClass("sel"))return $(this).removeClass("sel");$(this).addClass("sel")}),n.default.createDom(this.find("#j_priceBox"))},click:function(){var t=$.trim(this.find("#dsWord").val()),a=e.dsParams.goodsId,o=this;if(App.Utils.getTextLength(t)>30)return showInfo("留言不能超过30字",!1,{top:"86%"});if(!App.SensitiveModule.valide(t))return showInfo("请勿发布广告等不适内容",!1,{top:"86%"});if(""==a||void 0===a)return showInfo("请选择礼物",!1,{top:"86%"});e.dsParams.content=t.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.dsParams.giveType=this.find(".isShowToPc").hasClass("sel")?e.GIVE_TYPE.PUBLIC:e.GIVE_TYPE.PRIVITE;var s=this.getButton();s.hasClass("disabled")||(s.addClass("disabled"),this.cover(!0),e.ajaxDsMsg(e.dsParams).done(function(t){t&&0===t.code&&t.data&&t.data.banlanceEnough?(n.default.updateBalance(),i.close(),e.options.fromDetail?t.data.privateChat&&App.MsgModule.appendData(t.data.privateChat):e.dsParams.giveType===e.GIVE_TYPE.PUBLIC&&t.data.barrageInfo&&App.MsgModule.appendData(t.data.barrageInfo)):t&&0===t.code&&t.data&&!t.data.banlanceEnough?n.default.requireEncharge(t.data.minRechargeAmount,t.data.wechatMpPrePay.wxPayMpOrderResult):App.showInfo("操作失败",!1,{top:"86%"})}).fail(function(t){App.showInfo(t&&t.message||"操作失败",!1,{top:"86%"})}).always(function(){s.removeClass("disabled"),o.cover(!1)}))}})})},ajaxDsMsg:function(t){return $.ajax({url:Global.API_BASE+"/h5/give",method:"POST",dataType:"json",data:$.extend(t,{merchantId:Global.merchantId},this.options.params)})}},e.default=App.GiftModule},function(t,e,i){"use strict";function a(t){if($.extend(l,t),l.privateChat?l.prefix="chat":l.prefix="merchant",!1 in window)return void App.showInfo("WebSocket 不支持",!1);var e=new SockJS(Global.WS_BASE+"/websocket");o=Stomp.over(e),o.connect({},function(t){console.log("Connected: "+t),o.subscribe("/wsSend/"+l.prefix+"_"+l.chatId,function(t){t.body&&l.callback&&l.callback(JSON.parse(t.body))}),o.send("/ws/"+l.prefix+"_"+l.chatId,{},"")},r)}function n(){null!==o&&o.disconnect(),clearTimeout(s),console.log("Disconnected")}Object.defineProperty(e,"__esModule",{value:!0});var o=null,s=null,l={},r=function(t){console.log("STOMP: "+t),s=setTimeout(a,5e3),console.log("STOMP: Reconecting in 5 seconds")};e.default={connect:a,disconnect:n}},function(t,e){},function(t,e){},function(t,e){},,,,,,,function(t,e,i){"use strict";function a(t){return t&&t.__esModule?t:{default:t}}i(1);var n=i(0),o=a(n);i(2),i(7),i(3),i(4),i(5),i(6);var s=i(8),l=a(s);i(9);var r=i(10),c=a(r);i(11),i(12),i(13),i(21),App.MsgFormModule={$msgCnt:null,init:function(){this.$msgCnt=$("#j_msgFormCnt"),this.initUpload(),this.initEvent(),this.$msgCnt.find(".j_logo").attr("src",Global.User.userPicture).addClass("男"===Global.User.sex?"man":"woman")},initUpload:function(){var t=this;this.uploadInstance=App.UploadModule.instance({$input:this.$msgCnt.find("#upload"),onStart:function(){t.showUploading()},onError:function(e){t.uploadError(e&&e.message)},onSuccess:function(e){e&&0===e.code&&e.data?t.uploadSuccess(e.data):t.uploadError(e&&e.message)}})},initEvent:function(){var t=this;this.$msgCnt.on("click",".afterUpload",function(){t.delImage()}).on("click","#submit",function(){t.post($(this))}).on("submit","#form",function(){return t.post($("#submit")),!1})},showUploading:function(){this.$msgCnt.find("#txt").addClass("hasImage"),this.$msgCnt.find(".afterUpload").remove(),$('<a class="afterUpload"><tt class="onloading"></tt><tt class="slideClose"></tt></a>').appendTo(this.$msgCnt.find(".newFoot-inputBox"))},uploadSuccess:function(t){this.$msgCnt.find(".afterUpload").html('<img class="img" src="'+t+'" /><tt class="slideClose"></tt>')},uploadError:function(t){App.showInfo(t||"上传失败",!1),this.clearImg()},clearImg:function(){this.$msgCnt.find("#txt").removeClass("hasImage"),this.$msgCnt.find(".afterUpload").remove()},delImage:function(){var t=this;WM.Phone.get({type:"confirm",title:"删除",innerHTML:"确定删除此图片?",click:function(e){t.uploadInstance.clear(),t.clearImg(),this.close()}})},resetForm:function(){this.clearImg(),this.$msgCnt.find("#txt").val("")},post:function(t){var e=this;if(!t.hasClass("disabled")){var i=this.$msgCnt.find("#txt").val(),a=this.$msgCnt.find(".afterUpload .img").attr("src");if(!(i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;"))&&!a)return App.showInfo("请输入上墙内容或者上传图片",!1);t.addClass("disabled"),$.ajax({url:"/h5/addChat",method:"POST",data:{toUserId:Global.talkToId,content:i,chatId:Global.chatId,picUrl:a}}).done(function(t){t&&0===t.code?(e.resetForm(),App.MsgModule.appendData(t.data)):App.showInfo(t&&t.message,!1)}).fail(function(t){App.showInfo(t&&t.message,!1)}).always(function(){t.removeClass("disabled")})}}},App.MsgModule={$cnt:null,MSG_TYPE:{TEXT:0,PHOTO:1,GIVE:2,RED_BAG:3,VOTE:5,SONG:4,WORDS_AND_PHOTO:6,RED_BAG_GOT:7},STATUS:{REMOVE:4,NOT_SHOW:3,BA:2,NOT_BA:1},init:function(){var t=this;this.$cnt=$("#j_msgCnt").show(),this.$cnt.on("click",".j_delMsg",function(){t.delMsg($(this))}).on("click",".j_showSparmForTa",function(){App.SpamScreenModule.showPanel($(this),!0)}).on("click",".j_showImage",function(){t.showImage($(this))}),this.initFollowMsg()},getCnt:function(){return this.$cnt},initFollowMsg:function(){var t=this;$.post("/h5/getUserInfoByUserId",{userId:Global.talkToId}).then(function(e){if(e&&0===e.code&&e.data){var i="我已经关注了公众号，你给我发的消息微信将通知到我";1===e.data.status&&(i="我已经取消关注了公众号，你给我发的消息微信无法通知到我"),document.title=e.data.nickname;$(".j_showGiftPanel").attr("data-userpic",e.data.userPicture).attr("data-name",e.data.nickname).attr("data-uid",e.data.userId),$("#j_followMsg").html(t.createItem($.extend(e.data,{createTime:Date.now(),_followMsg:!0,fromUserId:e.data.userId,fromUserPic:e.data.userPicture,fromUserNickName:e.data.nickname,fromSex:e.data.sex,message:i})))}},function(){})},showImage:function(t){var e=$(t).attr("src");e&&WM.Phone.showImage(e)},createItem:function(t){return t=App.BasicFilter(t),t.content=App.SensitiveModule.filter(t.content),t.type===this.MSG_TYPE.GIVE?t.giveInfo?this.dsMsg(t):"":this.normalMsg(t)},dsMsg:function(t){return t._isGift=!0,this.normalMsg(t)},normalMsg:function(t){return template("msgTpl",t)},createHtml:function(t){function e(t){return!(!i.willShow(t)||i.isDulplicate(t))}var i=this,a="";return t=$.isArray(t)?t:[t],t.forEach(function(t){e(t)&&(a+=i.createItem(t))}),a},willShow:function(t){var e=null;return t.status===this.STATUS.REMOVE?(e=this.$cnt.find('.j_row[mid="'+t.messageId+'"]'),e.length&&e.remove(),!1):t.status!==this.STATUS.NOT_SHOW},isDulplicate:function(t){return!!this.$cnt.find('.j_row[mid="'+t.id+'"]').size()},appendData:function(t){this.$cnt.append(this.createHtml(t)),App.ScrollModule.down()},prependData:function(t){this.$cnt.prepend(this.createHtml(t))},ajaxDelMsg:function(t){return $.ajax({url:Global.API_BASE+"/h5/deleteBarrage",data:$.extend({openId:Global.openId,merchantId:Global.merchantId},t)})},delMsg:function(t){var e=this;WM.Phone.get({type:"confirm",title:"删除",innerHTML:"确定删除此上墙内容？",click:function(i){if(!i)return this.close();var a=t.closest(".j_row"),n=a.attr("mid");"wemewSystem"===Global.User.userId&&(a.remove(),this.close());var o=this;WM.Phone.setButton(this.getButton()[1],!1),e.ajaxDelMsg({messageId:n}).then(function(t){t&&0===t.code?(a.remove(),o.close(),e.checkNull()):(WM.Phone.setButton(o.getButton()[1],!0),App.showInfo(t&&t.message||"删除失败",!1))},function(t){WM.Phone.setButton(o.getButton()[1],!0),App.showInfo(t&&t.message||"删除失败",!1)})}})},checkNull:function(){if($(".row").length>0)return $("#onWallnull").remove();if(!($("#onWallnull").length>0))try{var t=document.title;$('<div id="onWallnull" style="text-align:center; font-size:13px; color:#fff; padding:20px 0; text-shadow:0 0 5px #000;">欢迎来到'+t+"</div>").insertBefore($("#first"))}catch(t){}}};var d={show:function(){var t=$(template("followPopTpl",{}));t.appendTo($("body")),this.bindEvent(t)},bindEvent:function(t){t.find(".j_closePop").on("click",function(){t.remove()});var e="./images/wxQrCode.png";$("img").load(function(){$(".j_loadingTip").remove(),t.find(".j_qrCode").attr("src",e).css("visibility","visible")}).attr("src",e)}};$(function(){var t=App.Utils.urlParam();if(!t.uid)return void alert("url参数uid丢失");Global.talkToId=t.uid,Global.merchantId=t.merchantId,Promise.all([Global.loadUserInfo(),Global.getChatId(),o.default.init()]).then(function(){App.ScrollModule.init(function(){new l.default({fromDetail:!0}).init()}),App.MsgModule.init(),App.MsgFormModule.init(),App.FaceModule.init($(".j_popFacePanel"),$("#txt")),App.UserBoxModule.init({fromDetail:!0}),App.GiftModule.init({fromDetail:!0,$triggerEl:$(".j_showGiftPanel"),params:{chatId:Global.chatId}}),1===Global.User.status&&d.show(),c.default.connect({chatId:Global.chatId,callback:function(t){App.MsgModule.appendData(t)}})})})},function(t,e){}]);